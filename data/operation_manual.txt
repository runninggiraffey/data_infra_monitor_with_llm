# 데이터 인프라 운영 매뉴얼

## 1. 클러스터 상황별 조치 가이드

### 1.1 클러스터 사용율이 높을 경우
- **상황**: CPU 사용률 70% 이상, 메모리 사용률 80% 이상
- **조치**: 
  1. heavy job을 찾아서 kill
  2. 리소스 사용량이 높은 프로세스 확인
  3. 필요시 노드 추가 검토
  4. 불필요한 서비스 중지

### 1.2 메모리 부족 상황
- **상황**: 메모리 사용률 90% 이상
- **조치**:
  1. 메모리 사용량이 높은 프로세스 식별
  2. 캐시 정리
  3. 불필요한 프로세스 종료
  4. 메모리 스왑 확인

### 1.3 디스크 공간 부족
- **상황**: 디스크 사용률 85% 이상
- **조치**:
  1. 로그 파일 정리
  2. 임시 파일 삭제
  3. 오래된 데이터 아카이브
  4. 스토리지 확장 검토

## 2. Spark 잡 관리

### 2.1 Spark 잡 모니터링
- **정기 점검**: 매시간 실행 중인 잡 확인
- **리소스 사용량**: CPU, 메모리 사용률 모니터링
- **실행 시간**: 장시간 실행 잡 식별

### 2.2 Spark 잡 관리 절차
1. 실행 중인 잡 목록 확인
2. 리소스 사용량이 높은 잡 식별
3. 우선순위에 따라 잡 종료
4. 잡 재시작 시 적절한 리소스 할당

### 2.3 잡 종료 기준
- CPU 사용률 90% 이상 지속
- 메모리 사용률 95% 이상
- 실행 시간 6시간 이상
- 다른 중요 잡에 영향 주는 경우

## 3. 하둡 클러스터 관리

### 3.1 HDFS 관리
- **디스크 공간**: 각 노드별 디스크 사용률 확인
- **복제본**: 데이터 복제본 상태 점검
- **블록 상태**: 손상된 블록 확인 및 복구

### 3.2 YARN 관리
- **리소스 할당**: 메모리 및 CPU 할당량 조정
- **큐 관리**: 작업 큐별 리소스 분배
- **애플리케이션**: 실행 중인 애플리케이션 모니터링

## 4. Presto 엔진 관리

### 4.1 쿼리 최적화
- **장시간 쿼리**: 실행 시간이 긴 쿼리 식별
- **리소스 사용량**: 메모리 사용량이 높은 쿼리 확인
- **동시 실행**: 동시 실행 쿼리 수 제한

### 4.2 성능 튜닝
- **메모리 설정**: 쿼리별 메모리 할당량 조정
- **병렬 처리**: 적절한 병렬 처리 수 설정
- **타임아웃**: 쿼리 타임아웃 설정

## 5. Jenkins 워크플로우 관리

### 5.1 파이프라인 모니터링
- **실행 상태**: 파이프라인 실행 상태 확인
- **실행 시간**: 장시간 실행 파이프라인 식별
- **실패 분석**: 실패한 파이프라인 원인 분석

### 5.2 리소스 관리
- **동시 실행**: 동시 실행 파이프라인 수 제한
- **에이전트**: Jenkins 에이전트 리소스 사용량 확인
- **정리**: 완료된 파이프라인 정리

## 6. Grafana 모니터링

### 6.1 대시보드 관리
- **메트릭 수집**: 주요 메트릭 수집 상태 확인
- **알람 설정**: 적절한 알람 임계값 설정
- **시각화**: 대시보드 시각화 최적화

### 6.2 알람 관리
- **알람 규칙**: 알람 규칙 정기 점검
- **알람 채널**: Slack 등 알람 채널 상태 확인
- **알람 응답**: 알람 발생 시 응답 절차

## 7. 긴급 상황 대응

### 7.1 클러스터 다운 상황
1. 즉시 상황 파악
2. 영향도 분석
3. 복구 절차 실행
4. 관련자 통보

### 7.2 데이터 손실 상황
1. 데이터 손실 범위 확인
2. 백업 데이터 확인
3. 복구 절차 실행
4. 재발 방지 대책 수립

## 8. 정기 점검 항목

### 8.1 일일 점검
- 클러스터 상태 확인
- 주요 서비스 동작 상태
- 리소스 사용률 확인
- 알람 발생 여부

### 8.2 주간 점검
- 성능 지표 분석
- 로그 분석
- 보안 점검
- 백업 상태 확인

### 8.3 월간 점검
- 용량 계획 검토
- 성능 최적화
- 보안 업데이트
- 문서 업데이트